{% load static %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load product_tags %}
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ page.seo_title|default:page.title }}</title>
  <meta name="description" content="{{ page.search_description }}" />
  <link rel="canonical" href="{{ request.build_absolute_uri }}" />
  {% if page.tiktok_pixel_code %}
    {{ page.tiktok_pixel_code|safe }}
  {% endif %}
  {% if page.meta_pixel_code %}
    {{ page.meta_pixel_code|safe }}
  {% endif %}
  {% if font_family and font_family != 'system' %}
    {% if font_family == 'inter' %}
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    {% elif font_family == 'roboto' %}
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    {% elif font_family == 'montserrat' %}
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    {% endif %}
  {% endif %}
  <style>
    html, body { overflow-x: hidden; }
    :root{
      --heading-w: {{ heading_weight|default:'700' }};
      --heading-lh: {{ heading_line_height|default:1.25 }};
      --title-w: {{ title_weight|default:'400' }};
      --title-lh: {{ title_line_height|default:1.30 }};
      --body-w: {{ body_weight|default:'300' }};
      --body-lh: {{ body_line_height|default:1.30 }};
    }
    :root { color-scheme: light dark; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; line-height: 1.5; }
    body.font-inter { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body.font-roboto { font-family: 'Roboto', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body.font-montserrat { font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    html { scroll-behavior: smooth; }
    body.light { --page-bg:#ffffff; background:#ffffff; color:#111111; }
    body.dark { --page-bg:#0b0b0b; background:#0b0b0b; color:#eaeaea; }
    /* Top bar */
    .topbar { position: sticky; top: 0; z-index: 50; display:flex; align-items:center; justify-content:space-between; padding: 12px 16px; }
    .topbar .logo { display:flex; align-items:center; gap:8px; color: inherit; text-decoration:none; font-weight:700; }
    .topbar .logo svg { width:22px; height:22px; }
    .menu-btn, .menu-close { background:none; border:0; width:44px; height:44px; display:grid; place-items:center; font-size:28px; cursor:pointer; color:inherit; }
    /* Overlay menu */
    .overlay { position: fixed; inset:0; background: rgba(0,0,0,0.08); backdrop-filter: blur(4px); display:none; z-index:60; }
    .overlay.active { display:block; }
    .overlay .panel { position:relative; max-width:960px; margin: 0 auto; padding: 16px; }
    .overlay nav { display:grid; justify-items:center; gap:16px; padding: 40px 0 24px; font-weight:600; }
    .overlay nav a { color: inherit; text-decoration:none; }
    .overlay .menu-close { position:absolute; right:8px; top:8px; }
    main { max-width: 960px; margin: 0 auto; padding: 16px; }
    h1, h2 { margin: 0 0 12px; }
    h1, h2, h3, p, label, strong, .promo .p-text, .benefits strong, .hero header p { font-weight: var(--body-w); line-height: var(--body-lh); }
    section h2 { text-align:center; font-size:32px; font-weight: var(--heading-w); line-height: var(--heading-lh); }
    section strong { font-size:22px; font-weight: var(--title-w); line-height: var(--title-lh); }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
    .hero { display: grid; grid-template-columns: 1fr; gap: 24px; align-items: start; }
    .hero .media img { width: 100%; height: auto; border-radius: 8px; }
    .hero header h1 { font-weight: var(--heading-w); line-height: var(--heading-lh); margin-bottom: 16px; }
    .hero header p { color:#555; margin-top: 6px; }
    .pricing { display:flex; align-items:center; gap:12px; margin: 8px 0 16px; }
    .price { font-size: 28px; font-weight: 700; }
    .old-price { color: #888; text-decoration: line-through; opacity:.7; }
    .btn { display: inline-block; padding: 12px 20px; border-radius: 999px; background:#ff2a19; color:#fff; text-decoration: none; font-weight:600; }

    section { margin: 40px 0; }

    /* Animated image alignment helpers */
    .animated { display:grid; }
    .animated.align-left { justify-items:start; }
    .animated.align-center { justify-items:center; }
    .animated.align-right { justify-items:end; }

    .promo { display:grid; grid-template-columns: 1fr; gap:24px; align-items:center; }
    .promo h2 { text-align:center; }
    .promo .p-text { color:#444; }
    .promo .p-cta { display:flex; align-items:center; gap:14px; justify-content:center; }
    .promo .p-cta .price { font-size:24px; font-weight:800; }
    .promo .p-cta .old-price { margin-left:0; }

    #benefits { max-width: 660px; margin: 40px auto; padding: 0 24px; }
    #benefits h2 { text-align:center; margin-bottom: 28px; }
    .benefits { list-style:none; padding:0; margin:24px 0 0; display:flex; flex-direction:column; gap:28px; }
    .benefits li { display:grid; grid-template-columns: 72px 1fr; gap:16px; align-items:flex-start; }
    .benefits strong { font-size:22px; font-weight: var(--title-w); line-height: var(--title-lh); }
    .benefits p { margin:6px 0 0; color:#555; }
    .benefit-icon { width:48px; height:48px; color:#2f5eff; }
    .benefit-icon img { width:48px; height:48px; object-fit:contain; }

    /* Title banner */
    .title-banner { display:grid; gap:16px; justify-items:center; max-width:960px; margin:0 auto; padding:0 16px; }
    .title-banner .tb-top, .title-banner .tb-bottom { text-align:center; font-size: clamp(36px, 6vw, 84px); font-weight: var(--title-w); line-height: var(--title-lh); color: var(--tb-color, currentColor); }
    .title-banner .tb-image { width:100%; }
    .title-banner .tb-image img { width:100%; height:auto; border-radius:8px; display:block; }

    /* Simple image (Banner) */
    .simple-image { margin: 0 auto; padding: 0; }
    .simple-image img { max-width: 860px; width: 100%; height: auto; display: block; margin: 0 auto; border-radius: 8px; }

    #steps h2 { text-align:center; margin-bottom: 28px; }
    .steps { list-style:none; counter-reset: step; margin:0; padding:8px 0; display:block; position:relative; overflow:hidden; }
    .steps li { position:relative; display:grid; grid-template-columns: 1fr 1fr; gap:24px; align-items:center; height: 80px; }
    .steps li + li { margin-top:20px; }
    .steps li::before { counter-increment: step; content: counter(step); position:absolute; left:50%; transform: translate(-50%, -50%); top:50%; width:52px; height:52px; border-radius:999px; background:#222; color:#fff; display:grid; place-items:center; font-weight:700; z-index:2; }
    .steps li::after { content:""; position:absolute; left:50%; transform:translateX(-50%); top:-50%; bottom:-50%; width:2px; background:#222; z-index:1; }
    .steps li:first-child::after { top:50%; bottom:-50%; }
    .steps li:last-child::after { top:-50%; bottom:50%; }
    .steps li .left, .steps li .right { text-align:left; position:relative; }
    .steps li:nth-child(odd) .left { justify-self:end; max-width: 360px; text-align:right; padding-right:56px; }
    .steps li:nth-child(odd) .right { visibility:hidden; height:0; }
    .steps li:nth-child(even) .right { justify-self:start; max-width: 360px; padding-left:56px; }
    .steps li:nth-child(even) .left { visibility:hidden; height:0; }
    .steps strong { font-size:22px; font-weight: var(--title-w); line-height: var(--title-lh); }
    .steps p { margin:6px 0 0; color:#555; font-weight: var(--body-w); line-height: var(--body-lh); }

    #form { max-width: 660px; margin: 40px auto; padding: 0 24px; }
    #form h2 { text-align:center; margin-bottom: 28px; }
    #form > p { text-align:center; max-width: 720px; margin: 0 auto 36px; color:#666; font-size: 20px; }
    form .field { margin-bottom: 20px; }
    form label { display:block; font-weight: 600; margin-bottom: 8px; }
    input, textarea, select, button { font: inherit; }
    input, textarea, select { width: 100%; padding: 18px 16px; border: 1px solid #222; border-radius: 2px; background: #fff; color:#111; }
    body.dark input, body.dark textarea, body.dark select { background:#0b0b0b; color:#eaeaea; border-color:#444; }
    ::placeholder { color:#9aa0a6; opacity:1; }
    body.dark ::placeholder { color:#8a8f98; }
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button { opacity: 1; height:auto; }
    select { appearance:none; -webkit-appearance:none; -moz-appearance:none; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>'); background-repeat:no-repeat; background-position: right 12px center; background-size: 18px; padding-right: 44px; }
    body.dark select { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>'); }
    button[type=submit] { display:block; margin: 8px auto 0; padding: 14px 24px; border-radius: 999px; border: 0; background: linear-gradient(135deg, #246BFF, #3D7BFF); color: #fff; font-weight:700; }

    #form h2 { text-align:center; }
    #form > p { text-align:center; max-width: 720px; margin: 0 auto 16px; color:#666; }

    /* Gallery carousel */
    #gallery { position: relative; background:#111; color:#fff; overflow:hidden; }
    .gallery-viewport { overflow: hidden; min-height: 85vh; display:grid; align-items:center; }
    .gallery-track { display:flex; gap:24px; overflow-x:auto; scroll-snap-type:x mandatory; padding: 0 50vw 12px; align-items:center; scrollbar-width: none; -ms-overflow-style: none; }
    .gallery-track::-webkit-scrollbar { display:none; height:0; }
    .gallery-track.single { justify-content:center; }
    .gallery-track img { height: min(53vh, 546px); width: auto; border-radius:12px; box-shadow: 0 8px 28px rgba(0,0,0,0.45); }
    .gallery-track .g-item { display:flex; flex-direction:column; align-items:center; gap:20px; scroll-snap-align:center; flex: 0 0 auto; }
    .gallery-track .g-top, .gallery-track .g-bottom { max-width: 720px; text-align:center; color:#ddd; padding: 0 8px; }
    .gallery-track .g-top { margin-bottom: 8px; }
    .gallery-track .g-bottom { margin-top: 8px; }
    #gallery .gallery-top, #gallery .gallery-bottom { max-width: 1200px; margin: 0 auto; padding: 16px 24px; color: #ddd; }
    #gallery .gallery-top { padding-top: 24px; }
    #gallery .gallery-bottom { padding-bottom: 24px; }
    .gallery-nav { position:absolute; inset: 0; pointer-events:none; }
    .gallery-btn { position:absolute; top:50%; transform: translateY(-50%); width:44px; height:44px; border-radius:999px; border:0; background:#ffffffcc; color:#111; display:grid; place-items:center; pointer-events:auto; cursor:pointer; }
    .gallery-btn.prev { left:16px; }
    .gallery-btn.next { right:16px; }
    body.dark .gallery-btn, #gallery .gallery-btn { background:#222c; color:#fff; }

    .gallery-dots { display:flex; justify-content:center; gap:10px; padding: 10px 0 18px; }
    .gallery-dots .dot {
      width:10px; height:10px; border-radius:50%; border:0; background:#666;
      opacity:.7; cursor:pointer; appearance:none; -webkit-appearance:none; display:inline-block;
    }
    .gallery-dots .dot.active { background:#fff; opacity:1; }

    @media (min-width: 768px) {
      .hero { grid-template-columns: 6fr 6fr; }
      .promo { grid-template-columns: 7fr 5fr; }
      .promo h2 { text-align:center; white-space: nowrap; }
      .promo .p-cta { justify-content:flex-end; }
      #benefits { max-width: 720px; padding: 0 48px; }
      #form { max-width: 720px; padding: 0 48px; }
      #form form { max-width: 660px; margin: 0 auto; }
    }
  </style>
</head>
<body class="{{ theme|default:'light' }} {% if font_family and font_family != 'system' %}font-{{ font_family }}{% endif %}">
  {% wagtail_site as current_site %}
  <header class="topbar">
    <a class="logo" href="{{ current_site.root_page.url }}" aria-label="Home">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M6 2l1 6h10l1-6z"/>
        <path d="M5 6h14l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2z"/>
      </svg>
      <span>{{ site_name|default:'Store' }}</span>
    </a>
    <button class="menu-btn" id="openMenu" aria-label="Open menu">≡</button>
  </header>

  <div class="overlay" id="menuOverlay" aria-hidden="true">
    <div class="panel">
      <button class="menu-close" id="closeMenu" aria-label="Close menu">×</button>
      <nav>
        <a href="{{ current_site.root_page.url }}">Головна</a>
      </nav>
    </div>
  </div>

  <main>
    {% for block in page.body %}
      {% if block.block_type == 'hero' %}
        <section id="hero" class="hero">
          <div class="media">
  {% if block.value.image %}
    {% image block.value.image width-1200 alt=block.value.title|default:product.name loading="lazy" class="hero-img" %}
  {% elif block.value.use_product_image and product and product.image %}
    <img src="{{ product.image.url }}" alt="{{ block.value.title|default:product.name|default:'Product image' }}" loading="lazy" itemprop="image" />
  {% else %}
    <div class="placeholder">No image available</div>
  {% endif %}
</div>
          <div class="content">
            <header>
              <h1>{{ block.value.title|default:product.name }}</h1>
              {% if block.value.subtitle %}<p>{{ block.value.subtitle }}</p>{% endif %}
            </header>
            <div class="pricing">
              {% if block.value.price %}
                <strong class="price">{{ block.value.price }} <span class="currency">грн.</span></strong>
              {% elif product %}
                <strong class="price">{{ product.price }} <span class="currency">грн.</span></strong>
              {% endif %}
              {% if block.value.old_price %}<s class="old-price">{{ block.value.old_price }} <span class="currency">грн.</span></s>{% endif %}
            </div>
            {% if block.value.cta_anchor %}
              <p><a class="btn" href="{{ block.value.cta_anchor }}">{{ block.value.cta_text }}</a></p>
            {% endif %}
          </div>
        </section>

      {% elif block.block_type == 'title_banner' %}
        <section id="title-banner" class="title-banner" style="--tb-color: {{ block.value.text_color|default:'#cc5a12' }};">
          {% if block.value.top_text %}
            <div class="tb-top">{{ block.value.top_text }}</div>
          {% endif %}
          <div class="tb-image">
            {% if block.value.image %}
              {% image block.value.image width-1920 loading="lazy" %}
            {% endif %}
          </div>
          {% if block.value.bottom_text %}
            <div class="tb-bottom">{{ block.value.bottom_text }}</div>
          {% endif %}
        </section>

      {% elif block.block_type == 'gallery' %}
        <section id="gallery" style="width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);">
          <div class="gallery-viewport">
            <div class="gallery-track{% if block.value.items|length == 1 %} single{% endif %}" id="galleryTrack">
              {% for it in block.value.items %}
                <div class="g-item">
                  {% if it.top_text %}<div class="g-top">{{ it.top_text }}</div>{% endif %}
                  {% image it.image width-800 loading="lazy" %}
                  {% if it.bottom_text %}<div class="g-bottom">{{ it.bottom_text }}</div>{% endif %}
                </div>
              {% endfor %}
            </div>
          </div>
          {% if block.value.items and block.value.items|length > 1 %}
            <div class="gallery-dots" id="galleryDots">
              {% for _ in block.value.items %}
                <button type="button" class="dot" aria-label="Go to slide {{ forloop.counter }}"></button>
              {% endfor %}
            </div>
          {% endif %}
          <div class="gallery-nav" aria-hidden="true">
            <button type="button" class="gallery-btn prev" id="galPrev" aria-label="Previous">‹</button>
            <button type="button" class="gallery-btn next" id="galNext" aria-label="Next">›</button>
          </div>
          <script>
            (function(){
              const track = document.getElementById('galleryTrack');
              if(!track) return;

              const items = Array.from(track.querySelectorAll('.g-item')).length
                ? Array.from(track.querySelectorAll('.g-item'))
                : Array.from(track.querySelectorAll('img'));
              const GAP = 24; // keep in sync with CSS .gallery-track gap

              function centerItem(el){
                if(!el) return;
                const container = track;
                const elCenter = el.offsetLeft + (el.clientWidth / 2);
                const target = elCenter - (container.clientWidth / 2);
                container.scrollTo({ left: Math.max(0, target), behavior: 'smooth' });
              }

              function getCenteredIndex(){
                const viewportCenter = track.scrollLeft + (track.clientWidth / 2);
                let bestIdx = 0, bestDist = Infinity;
                items.forEach((el, idx) => {
                  const center = el.offsetLeft + (el.clientWidth / 2);
                  const dist = Math.abs(center - viewportCenter);
                  if(dist < bestDist){ bestDist = dist; bestIdx = idx; }
                });
                return bestIdx;
              }

              // Click to center
              items.forEach((el) => el.addEventListener('click', () => centerItem(el)));

              // Arrows to move left/right based on currently centered item
              const prev = document.getElementById('galPrev');
              const next = document.getElementById('galNext');
              prev && prev.addEventListener('click', () => {
                const idx = getCenteredIndex();
                const target = items[Math.max(0, idx - 1)];
                centerItem(target);
              });
              next && next.addEventListener('click', () => {
                const idx = getCenteredIndex();
                const target = items[Math.min(items.length - 1, idx + 1)];
                centerItem(target);
              });

              // Dots
              const dotsWrap = document.getElementById('galleryDots');
              const dots = dotsWrap ? Array.from(dotsWrap.querySelectorAll('.dot')) : [];
              function updateDots(activeIdx){
                dots.forEach((d, i) => d.classList.toggle('active', i === activeIdx));
              }
              dots.forEach((d, i) => d.addEventListener('click', () => centerItem(items[i])));

              // Sync on scroll (throttled)
              let rafId = null;
              function onScroll(){
                if(rafId) return; rafId = requestAnimationFrame(() => {
                  rafId = null;
                  updateDots(getCenteredIndex());
                });
              }
              track.addEventListener('scroll', onScroll, { passive: true });

              // On load, center the first or the nearest already-in-view item
              if(items.length){
                requestAnimationFrame(() => { centerItem(items[0]); updateDots(0); });
              }
            })();
          </script>
        </section>

      {% elif block.block_type == 'image' %}
        <section class="simple-image">
          {% if block.value.image %}
            {% image block.value.image width-1200 alt=block.value.alt|default:'' loading="lazy" %}
          {% endif %}
        </section>

      {% elif block.block_type == 'video' %}
        <section id="video" style="width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);">
          <div class="video-wrapper" style="height: {{ block.value.height }}px;">
            <iframe width="100%" height="100%" src="https://www.youtube.com/embed/{{ block.value.youtube_id|youtube_id }}?rel=0&modestbranding=1&playsinline=1&origin={{ request.scheme }}://{{ request.get_host }}&widget_referrer={{ request.build_absolute_uri|urlencode }}" title="YouTube video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="origin-when-cross-origin" allowfullscreen loading="lazy"></iframe>
          </div>
        </section>

      {% elif block.block_type == 'animated' %}
        <section id="animated-image" class="animated align-{{ block.value.alignment|default:'center' }}">
          {% if block.value.image %}
            <img src="{{ block.value.image.file.url }}" alt="{{ block.value.alt|default:'' }}" style="max-width:100%;height:auto;border-radius:8px;" loading="lazy" />
          {% endif %}
        </section>

      {% elif block.block_type == 'text' %}
        <section class="text-section">
          {{ block.value.html|richtext }}
        </section>

      {% elif block.block_type == 'promo' %}
        <section id="promo" class="promo">
          <div>
            <h2>{{ block.value.title }}</h2>
            {% if block.value.text %}
              <p class="p-text">{{ block.value.text }}</p>
            {% endif %}
          </div>
          <div class="p-cta">
            {% if block.value.price %}
              <strong class="price">{{ block.value.price }} <span class="currency">грн.</span></strong>
            {% elif product %}
              <strong class="price">{{ product.price }} <span class="currency">грн.</span></strong>
            {% endif %}
            {% if block.value.old_price %}<s class="old-price">{{ block.value.old_price }} <span class="currency">грн.</span></s>{% endif %}
            {% if block.value.cta_anchor %}
              <a class="btn" href="{{ block.value.cta_anchor }}">{{ block.value.cta_text }}</a>
            {% endif %}
          </div>
        </section>

      {% elif block.block_type == 'benefits' %}
        <section id="benefits">
          {% if block.value.title %}<h2>{{ block.value.title }}</h2>{% endif %}
          <ul class="benefits">
            {% for it in block.value.items %}
              <li>
                <div class="benefit-icon">
                  {% if it.icon %}{% image it.icon width-48 loading="lazy" %}{% else %}
                  <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" width="48" height="48">
                    <path d="M6 26 L18 36 L42 10" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  {% endif %}
                </div>
                <div>
                  <strong>{{ it.title }}</strong>
                  <p>{{ it.description }}</p>
                </div>
              </li>
            {% endfor %}
          </ul>
        </section>

      {% elif block.block_type == 'steps' %}
        <section id="steps">
          {% if block.value.title %}<h2>{{ block.value.title }}</h2>{% endif %}
          <ol class="steps">
            {% for st in block.value.items %}
              <li>
                <div class="left">
                  <strong>{{ st.title }}</strong>
                  <p>{{ st.description }}</p>
                </div>
                <div class="right">
                  <strong>{{ st.title }}</strong>
                  <p>{{ st.description }}</p>
                </div>
              </li>
            {% endfor %}
          </ol>
        </section>

      {% elif block.block_type == 'form' %}
        <section id="form">
          {% if block.value.title %}<h2>{{ block.value.title }}</h2>{% endif %}
          {% if block.value.subtitle %}<p>{{ block.value.subtitle }}</p>{% endif %}
          <form method="post">
            {% csrf_token %}
            {% if block.value.show_full_name %}
            <div class="field">
              <label for="full_name">ФІО</label>
              <input id="full_name" type="text" name="full_name" required placeholder="Введіть Ваше ім’я" />
            </div>
            {% endif %}
            {% if block.value.show_country %}
            <div class="field">
              <label for="country">Країна</label>
              <select id="country" name="country">
                <option value="UA" selected>Ukraine</option>
                <option value="PL">Poland</option>
                <option value="DE">Germany</option>
                <option value="CZ">Czechia</option>
                <option value="SK">Slovakia</option>
                <option value="RO">Romania</option>
                <option value="HU">Hungary</option>
                <option value="LT">Lithuania</option>
                <option value="LV">Latvia</option>
                <option value="EE">Estonia</option>
              </select>
            </div>
            {% endif %}
            {% if block.value.show_phone %}
            <div class="field">
              <label for="phone">Телефон</label>
              <input id="phone" type="tel" name="phone" required placeholder="+380 (99) 999-99-99" />
              <small id="phone-hint">Приклад: +380 99 99-9999</small>
            </div>
            {% endif %}
            {% if block.value.show_email %}
            <div class="field">
              <label for="email">Email</label>
              <input id="email" type="email" name="email" placeholder="name@example.com" />
            </div>
            {% endif %}
            {% if block.value.show_quantity %}
            <div class="field">
              <label for="quantity">Кількість</label>
              <input id="quantity" type="number" min="1" step="1" name="quantity" value="1" placeholder="1" />
            </div>
            {% endif %}
            {% if block.value.show_comment %}
            <div class="field">
              <label for="comment">Коментар</label>
              <textarea id="comment" name="comment" rows="3" placeholder="Ваш коментар"></textarea>
            </div>
            {% endif %}
            <!-- CRM hidden fields (external compatibility) -->
            <input type="hidden" name="price" value="{% if product %}{{ product.price }}{% endif %}">
            <input type="hidden" name="id" value="{% if product %}{{ product.id }}{% endif %}">
            <input type="hidden" name="country" value="UA">
            <input type="hidden" name="office" value="6">
            <input type="hidden" name="user_ip" value="">
            <input type="hidden" name="site" value="{{ request.build_absolute_uri }}">

            <button type="submit">{{ block.value.submit_text }}</button>
          </form>
          <script>
          (function(){
            // Fetch IP
            fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>{
              document.querySelectorAll('input[name="user_ip"]').forEach(function(i){ i.value = d.ip; });
            }).catch(()=>{});
          })();
          </script>
        </section>
      {% endif %}
    {% endfor %}
  </main>
  <script>
    (function(){
      const open = document.getElementById('openMenu');
      const close = document.getElementById('closeMenu');
      const overlay = document.getElementById('menuOverlay');
      function show(){ overlay.classList.add('active'); overlay.setAttribute('aria-hidden','false'); }
      function hide(){ overlay.classList.remove('active'); overlay.setAttribute('aria-hidden','true'); }
      open && open.addEventListener('click', show);
      close && close.addEventListener('click', hide);
      overlay && overlay.addEventListener('click', function(e){ if(e.target===overlay) hide(); });
    })();
  </script>
</body>
</html>
<!-- DEBUG: 
block.value.use_product_image = {{ block.value.use_product_image }}
block.value.image = {{ block.value.image|yesno:"exists,missing" }}
product = {{ product|yesno:"exists,missing" }}
product.image = {{ product.image|yesno:"exists,missing" }}
-->