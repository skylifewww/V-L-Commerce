{% load static product_tags %}
{% load wagtailcore_tags %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ page.seo_title|default:page.title }}</title>
  <meta name="description" content="{{ page.search_description }}" />
  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .topbar { position: sticky; top:0; z-index:50; display:flex; align-items:center; justify-content:space-between; padding:12px 16px; }
    .topbar .logo { display:flex; align-items:center; gap:8px; color:inherit; text-decoration:none; font-weight:700; }
    .topbar .logo svg { width:22px; height:22px; }
    .menu-btn, .menu-close { background:none; border:0; width:44px; height:44px; display:grid; place-items:center; font-size:28px; cursor:pointer; }
    .overlay { position:fixed; inset:0; background:#00000022; backdrop-filter: blur(4px); display:none; }
    .overlay.active { display:block; }
    .overlay .panel { position:relative; max-width:960px; margin:0 auto; padding:16px; }
    .overlay nav { display:grid; justify-items:center; gap:16px; padding:40px 0 24px; font-weight:600; }
    .overlay .menu-close { position:absolute; right:8px; top:8px; }
    .page-title { max-width:960px; margin:12px auto 0; padding:0 16px; text-align:center; font-size: clamp(28px, 5vw, 56px); font-weight:700; }
    main { max-width:960px; margin:0 auto; padding:16px; }
  </style>
</head>
<body>
  {% wagtail_site as current_site %}
  <header class="topbar">
    <a class="logo" href="{{ current_site.root_page.url }}" aria-label="Home">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M6 2l1 6h10l1-6z"/>
        <path d="M5 6h14l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2z"/>
      </svg>
      <span>{{ site_name|default:'Store' }}</span>
    </a>
    <button class="menu-btn" id="openMenu" aria-label="Open menu">≡</button>
  </header>
  <div class="overlay" id="menuOverlay" aria-hidden="true">
    <div class="panel">
      <button class="menu-close" id="closeMenu" aria-label="Close menu">×</button>
      <nav>
        <a href="{{ current_site.root_page.url }}">Головна</a>
      </nav>
    </div>
  </div>

  <h1 class="page-title">{{ page.title }}</h1>

  <main>
    {% for block in page.body %}
      {% if block.block_type == 'featured' %}
        <section>
          <h2>{{ block.value.title|default:"Рекомендуем" }}</h2>
          <div class="grid">
            {% render_product_grid featured_products %}
          </div>
        </section>
      {% elif block.block_type == 'grid' %}
        <section>
          <h2>{{ block.value.title }}</h2>
          <div class="grid">
            {% with slug=block.value.category_slug %}
              {% render_product_grid featured_products slug %}
            {% endwith %}
          </div>
        </section>
      {% elif block.block_type == 'testimonials' %}
        <section>
          <h2>{{ block.value.title }}</h2>
          <div class="testimonials">
            {% for it in block.value.items %}
              <blockquote>
                <p>“{{ it.quote }}”</p>
                {% if it.avatar %}
                  <img src="{{ it.avatar.url }}" alt="{{ it.author }}" loading="lazy" width="64" height="64" />
                {% endif %}
                <footer>— {{ it.author }}</footer>
              </blockquote>
            {% endfor %}
          </div>
        </section>
      {% elif block.block_type == 'cta' %}
        <section>
          <h2>{{ block.value.title }}</h2>
          <p>{{ block.value.subtitle }}</p>
          <a href="{{ page.get_url }}#catalog" class="btn">{{ block.value.button_text }}</a>
        </section>
      {% endif %}
    {% endfor %}
  </main>
  <script>
    (function(){
      const open = document.getElementById('openMenu');
      const close = document.getElementById('closeMenu');
      const overlay = document.getElementById('menuOverlay');
      function show(){ overlay.classList.add('active'); overlay.setAttribute('aria-hidden','false'); }
      function hide(){ overlay.classList.remove('active'); overlay.setAttribute('aria-hidden','true'); }
      open && open.addEventListener('click', show);
      close && close.addEventListener('click', hide);
      overlay && overlay.addEventListener('click', function(e){ if(e.target===overlay) hide(); });
    })();
  </script>
</body>
</html>
